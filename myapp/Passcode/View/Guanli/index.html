<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Material Design Bootstrap</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="__PUBLIC__/lib/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="__PUBLIC__/PasscodeIndex/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="__PUBLIC__/PasscodeIndex/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="__PUBLIC__/PasscodeIndex/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Start your project here-->
    <div class="container">
        <!--Navbar-->
        <nav class="navbar navbar-dark bg-primary">
            <!-- Collapse button-->
            <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#collapseEx2">
                <i class="fa fa-bars"></i>
            </button>
            <div class="container">
                <!--Collapse content-->
                <div class="collapse navbar-toggleable-xs" id="collapseEx2">
                    <!--Navbar Brand-->
                    <a class="navbar-brand">Ingress 兑换代码</a>
                    <!--Links-->
                    <ul class="nav navbar-nav">
<!--                         <li class="nav-item active">
                            <a class="nav-link">Home <span class="sr-only">(current)</span></a>
                        </li> -->
                        <li class="nav-item ">
                            <a href="{:U('Passcode/Submit/index')}" class="nav-link pull-right">提交新代码</a>
                        </li>
<!--                         <li class="nav-item">
                            <a class="nav-link">Pricing</a>
                        </li>
                        <li class="nav-item btn-group">
                            <a class="nav-link dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                <a class="dropdown-item">Action</a>
                                <a class="dropdown-item">Another action</a>
                                <a class="dropdown-item">Something else here</a>
                            </div>
                        </li> -->
                    </ul>
                    <form class="form-inline">
                        <input class="form-control" type="text" placeholder="Search">
                    </form>
                </div>
                <!--/.Collapse content-->
            </div>
        </nav>
        <!--/.Navbar-->
        <div class="col-md-12">
            <a href="#" class="btn btn-primary" id="approve">通过</a>
            <a href="#" class="btn btn-warning" id="delete">删除</a>
        </div>
        <table class="table" id="table">
            <thead>
                <tr>
                    <td><input type="checkbox" id="selectAll"></td>
                    <td>#</td>
                    <td>代码</td>
                    <td>状态</td>
                    <td>投票数</td>
                    <td>成功率%</td>
                    <td>生日</td>
                    <td>IP</td>
                    <td>操作</td>
                </tr>
            </thead>
            <tbody>
            <foreach name="data" item="code">
                <tr>   
                    <td><input type="checkbox" name="deleteid" data-id="{$code.id}" value="{$code.id}"></td>
                    <td>{$code.id}</td>
                    <td>{$code.passcode}</td>
                    <td>{$code.status}</td>
                    <td>{$code['votes']?$code['votes']:''}</td>
                    <td>{$code['votes']?$code['yes']/$code['votes']*100:''}</td>
                    <td>{$code.createdate}</td>
                    <td>{$code.ip}</td>
                    <td><a href="" class="btn btn-primary btn-sm">按钮</a></td>
                </tr>
            </foreach>
            </tbody>
        </table>

        <!--/.Panel结束-->
        <!-- container 结束 -->
        <div class="row">
            <!--Pagination blue grey-->
            <nav class="page-number">
                <ul class="pagination pg-bluegrey">
                    <!--Arrow left-->
<!--                     <li class="page-item">
                        <a class="page-link" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li> -->

                    <!--Numbers-->
                    <for start="1" end="$pageInfo.totalPage">
                        
                        <li class="page-item <if condition='$pageInfo.currPage eq $i'>active</if>"><a href="{:U('Passcode/Guanli/index?p='.$i)}" class="page-link">{$i}</a></li>
                    
                    </for>
                    <!--Arrow right-->
<!--                     <li class="page-item">
                        <a class="page-link" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li> -->
                </ul>
            </nav>
            <!--/Pagination grey-->
        </div>
    </div>
    <!-- /Start your project here-->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="__PUBLIC__/PasscodeIndex/js/jquery-2.2.3.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="__PUBLIC__/PasscodeIndex/js/tether.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="__PUBLIC__/PasscodeIndex/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="__PUBLIC__/PasscodeIndex/js/mdb.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/layer.js"></script>
    <script>
        var voteAPI="{:U('Passcode/index/vote')}"
    </script>
    <script src="__PUBLIC__/js/js.cookie.js"></script>
    <script src="__PUBLIC__/js/jquery-lang.js"></script>
    <script type="text/javascript" src="__PUBLIC__/PasscodeIndex/js/main.js"></script>
    <script>

    $(document).ready(function() {
        var table=$("#table");
        var tbody=table.find("tbody");
        var tbodyinput=tbody.find("input");
        tbodyinput.click(function(event){
            event.stopPropagation();
        })
        tbody.find("tr").click(function(e){
            $(this).find("input").each(function(){
                this.checked=!this.checked;
            })
        })

        $("#selectAll").click(function(){
            if(this.checked){
               tbodyinput.each(function(){
                this.checked=true;
               })
            }else{
                tbodyinput.each(function(){
                this.checked=false;
               })
            }
        })

        function shwoRes(content){
            try{
               var res=JSON.parse(content);
               layer.msg(res.message,{icon:7});
               return false;
            }catch(e){
                layer.msg("服务器返回错误: "+e.message,{icon:7});
                return false;
            }
        }

        $("#approve").click(function(){
            var postdata={'action':'approve','id':[]};
            tbodyinput.each(function(){
                if(this.checked){
                    postdata['id'].push(this.dataset.id);
                }
            })
            if(postdata['id'].length==0){
                layer.msg("并没有选择任何条目",{icon:7});
                return false;
            }
            $.post("{:U('Guanli/save')}",postdata,function(response){
                shwoRes(response);
            })
        })

        $("#delete").click(function(){
            layer.confirm('确定？', {
              btn: ['是的','点错'] //按钮
            }, function(){
                var postdata={'action':'delete','id':[]};
                tbodyinput.each(function(){
                    if(this.checked){
                        postdata['id'].push(this.dataset.id);
                    }
                })
                if(postdata['id'].length==0){
                    layer.msg("并没有选择任何条目",{icon:7});
                    return false;
                }
                $.post("{:U('Guanli/save')}",postdata,function(response){
                    shwoRes(response);
                })
            }, function(){

            });

        })
    })


    </script>
</body>

</html>
