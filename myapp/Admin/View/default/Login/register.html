<include file="myapp/Admin/View/default/Index/header.html"/>
	<div class="row">
		<div class="col-md-4 col-md-offset-4">
			<h3>注册</h3>
			<p class="help-block">然后加入我们</p>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4 col-md-offset-4">
			<form>
				<div class="form-group"><input type="email" id="email" class="form-control" name="email" placeholder="请输入邮箱"></div>
				<div class="form-group"><input type="text" id="username" class="form-control" name="username" placeholder="请输入用户名"></div>
				<div class="form-group"><input type="text" id="password" class="form-control" name="password" placeholder="请输入密码"></div>
				<div class="form-group"><input type="text" id="password2" class="form-control" placeholder="请再次输入密码"></div>
<!-- 				<div class="form-group">
					<label for="gendermale">先生<input id="gendermale" type="radio" value="male" name="gender" placeholder=""></label>
					<label for="genderfemale">女士<input id="genderfemale" type="radio" value="female" name="gender" placeholder=""></label>
				</div>
				<div class="form-group">
					<label for="agreement">
						<input id="agreement" type="checkbox" name="agree" value="yes">
						我已详细阅读并同意注册条款
					</label>
				</div> -->
				<div class="form-group">
					<p id="tip"></p>
				</div>
				<div class="form-group">
					<button type="submit" class="btn btn-primary form-control" disabled="" id="confirm">确定注册</button>
				</div>
				<div class="form-group">
					<a href="{:U('index')}" class="btn btn-info form-control">返回登陆</a>
				</div>
			</form>
		</div>
	</div>
<script>
$("input").on("click",function(){
	$(this).parent().removeClass('has-error');
	$(this).parent().removeClass('has-success');
})

var usernameok=0,passwordok=0,emailok=0;
$("#email").on("blur",function(){

	var parentDIV=$(this).parent();
	var thisInput=$(this);
	if(!$(this).val().trim().match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)){
		parentDIV.addClass("has-error");
		$("#email+p").remove();
		createTip("邮箱格式不正确",thisInput,"text-danger");
	}else{
		parentDIV.removeClass("has-error");
		$("#email+p").remove();
		check('email',$(this).val(),tipAfterCheck,"email");
		emailok=1;
		infoComplete();
	}
})

$("#username").on("blur",function(){
	var parentDIV=$(this).parent();
	var thisInput=$(this);
	if(thisInput.val().trim().length==0){
		parentDIV.addClass("has-error");
		$("#username+p").remove();
		createTip("请取一个名字",thisInput,"text-danger");
	}else{
		parentDIV.removeClass("has-error");
		$("#username+p").remove();
		check('username',thisInput.val(),tipAfterCheck,"username");
		usernameok=1;
		infoComplete();
	}
})

$("#password").on("blur",pwdConsistency);
$("#password2").on("blur",pwdConsistency);

$("button").on("click",function(){
	var api="{:U('Admin/Login/register')}";
	var formData=$("form").serialize();
	$.post(api,formData,function(data,status){
		var response=JSON.parse(data);
		if(response.code==200){
			layer.msg(response.message,{"icon":1});
			setTimeout(function(){
				location.href="{:U('Index/index')}";
			},1500)
		}else{
			layer.msg(response.message,{"icon":2});
		}
	})
	return false;
})

function infoComplete(){
	if(emailok && passwordok && usernameok){
		var btn=$("button")[0];
		$(btn).removeAttr("disabled");
	}
}


function pwdConsistency(){
	var p1=$("#password").val().trim(),p2=$("#password2").val().trim(),tipPosition=$("#password2");
	$("#password2+p").remove();
	if(p1.length<=4 || p2.length<=4){
		$("#password2+p").remove();
		createTip("密码不能少于5个字符",tipPosition,"text-danger");
	}else if(p1!=p2){
		$("#password2+p").remove();
		createTip("两次密码输入不一致",tipPosition,"text-danger");
	}else{
		$("#password2+p").remove();
		passwordok=1;
		infoComplete()
	}
}

function tipAfterCheck(result,elementId){
	var seletorString="#"+elementId;
	if(result.code==199){
		$(seletorString+"+p").remove();
		createTip(result.message,$(seletorString),"text-danger");
	}else if(result.code==200){
		$(seletorString+"+p").remove();
		createTip(result.message,$(seletorString),"text-success");
	}
}


function createTip(content,element,cls){
	var tipContent=$("<p class="+cls+"></p>").text(content);
	$(element).after(tipContent);
}

function check(type,value,callback,elementId){
	var api="{:U('Admin/Login/check')}";
	var checkdata="type="+type+"&value="+value;
	$.post(api,checkdata,function(data,status){
		callback(JSON.parse(data),elementId);
	})
}
</script>
<include file="myapp/Admin/View/default/Index/footer.html"/>
